<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Twitch on Toto do stuff</title><link>https://blog.totetmatt.fr/tags/twitch/</link><description>Recent content in Twitch on Toto do stuff</description><generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Sat, 03 Oct 2020 11:00:00 +0100</lastBuildDate><atom:link href="https://blog.totetmatt.fr/tags/twitch/index.xml" rel="self" type="application/rss+xml"/><item><title>Twitch and FFmpeg and Youtube-dl: Fetch from live stream to local file</title><link>https://blog.totetmatt.fr/posts/2020-10-13_twitch-and-ffmpeg-with-some-youtube-dl-help-fetch-from-live-stream-to-local-file/</link><pubDate>Sat, 03 Oct 2020 11:00:00 +0100</pubDate><guid>https://blog.totetmatt.fr/posts/2020-10-13_twitch-and-ffmpeg-with-some-youtube-dl-help-fetch-from-live-stream-to-local-file/</guid><description>&lt;p>&lt;em>(Using Windows PowerShell, adapt for UNIX bash shouldn’t be a big issue)&lt;/em>&lt;/p>
&lt;h1 id="record-a-live-stream">Record a live stream&lt;/h1>
&lt;p>So something nice with youtube-dl is like you can ask not to download the media but to fetch for the media link :&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&amp;gt;&amp;gt; youtube-dl -g https://www.youtube.com/watch?v&lt;span style="color:#f92672">=&lt;/span>RJt01u4yrLQ
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>https://r2---sn-h0jeened.googlevideo.com/videoplayback?expire&lt;span style="color:#f92672">=&lt;/span>1&lt;span style="color:#f92672">[&lt;/span>...&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>If you use that for a twitch channel that is streaming live, it returns you the HLS stream.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&amp;gt;&amp;gt; youtube-dl -g https://www.twitch.tv/farore_de_firone
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>https://video-weaver.ber01.hls.ttvnw.net/v1/playlist/CpkEQusnrcdffNI3&lt;span style="color:#f92672">[&lt;/span>..&lt;span style="color:#f92672">]&lt;/span>MA2c4.m3u8
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It by default binds to the best quality video, but you can check and select all format available using -F&lt;/p></description><content>&lt;p>&lt;em>(Using Windows PowerShell, adapt for UNIX bash shouldn’t be a big issue)&lt;/em>&lt;/p>
&lt;h1 id="record-a-live-stream">Record a live stream&lt;/h1>
&lt;p>So something nice with youtube-dl is like you can ask not to download the media but to fetch for the media link :&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&amp;gt;&amp;gt; youtube-dl -g https://www.youtube.com/watch?v&lt;span style="color:#f92672">=&lt;/span>RJt01u4yrLQ
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>https://r2---sn-h0jeened.googlevideo.com/videoplayback?expire&lt;span style="color:#f92672">=&lt;/span>1&lt;span style="color:#f92672">[&lt;/span>...&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>If you use that for a twitch channel that is streaming live, it returns you the HLS stream.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&amp;gt;&amp;gt; youtube-dl -g https://www.twitch.tv/farore_de_firone
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>https://video-weaver.ber01.hls.ttvnw.net/v1/playlist/CpkEQusnrcdffNI3&lt;span style="color:#f92672">[&lt;/span>..&lt;span style="color:#f92672">]&lt;/span>MA2c4.m3u8
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It by default binds to the best quality video, but you can check and select all format available using -F&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&amp;gt;&amp;gt; youtube-dl -F https://www.twitch.tv/farore_de_firone
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>twitch:stream&lt;span style="color:#f92672">]&lt;/span> farore_de_firone: Downloading stream GraphQL
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>twitch:stream&lt;span style="color:#f92672">]&lt;/span> farore_de_firone: Downloading access token JSON
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>twitch:stream&lt;span style="color:#f92672">]&lt;/span> 39653517372: Downloading m3u8 information
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>info&lt;span style="color:#f92672">]&lt;/span> Available formats &lt;span style="color:#66d9ef">for&lt;/span> 39653517372:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>format code extension resolution note
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>audio_only mp4 audio only 2k , mp4a.40.2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>160p mp4 284x160 230k , avc1.4D401F, 30.0fps, mp4a.40.2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>360p mp4 640x360 630k , avc1.4D401F, 30.0fps, mp4a.40.2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>480p mp4 852x480 1262k , avc1.4D401F, 30.0fps, mp4a.40.2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>720p60 mp4 1280x720 3257k , avc1.4D401F, 60.0fps, mp4a.40.2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>1080p60__source_ mp4 1920x1080 6713k , avc1.64002A, 60.0fps, mp4a.40.2 &lt;span style="color:#f92672">(&lt;/span>best&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>You could even only have the audio-stream&lt;/p>
&lt;p>And to select it&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>youtube-dl -f 160p -g https://www.twitch.tv/farore_de_firone
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>So with this link, you can use ffmpeg to record localy the stream to your computer (and have your own reaplay / VOD without the “disagreement” of Twitch VOD :) )&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>ffmpeg -i &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>youtube-dl -f 720p60 -g https://www.twitch.tv/farore_de_firone&lt;span style="color:#66d9ef">)&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> -c copy stream.20201012.mp4
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And here it’s quite simple “dump” of the running script. Nothing prevent you to add some filters, reencoding that adapt to your needs.&lt;/p>
&lt;h1 id="mixing-multiple-stream">Mixing multiple stream&lt;/h1>
&lt;p>Let’s have some fun, there is some streamers that plays together on the same game. Usually, you can watch their POV at the sametime with the Twitch Squad mechanism or Multitwitch application. But would it be possible to record a file in such way ?&lt;/p>
&lt;p>Actually yes, ffmpeg can take multiple video input and transform it on the fly via the filter complex to render all the video on the same stream.&lt;/p>
&lt;p>There is a nice topic on Stackoverflow that explain how to simply stack multiple video : &lt;a href="https://stackoverflow.com/questions/11552565/vertically-or-horizontally-stack-mosaic-several-videos-using-ffmpeg">https://stackoverflow.com/questions/11552565/vertically-or-horizontally-stack-mosaic-several-videos-using-ffmpeg&lt;/a>&lt;/p>
&lt;p>Example merging 2 videos :&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>ffmpeg -i &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>youtube-dl -g https://www.twitch.tv/antoinedaniellive&lt;span style="color:#66d9ef">)&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -i &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>youtube-dl -g https://www.twitch.tv/soon&lt;span style="color:#66d9ef">)&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -filter_complex vstack&lt;span style="color:#f92672">=&lt;/span>inputs&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -map 0:a &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> output.mp4
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Example merging 4 videos :&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>ffmpeg -i &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>youtube-dl -f 160p -g https://www.twitch.tv/antoinedaniellive&lt;span style="color:#66d9ef">)&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -i &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>youtube-dl -f 160p -g https://www.twitch.tv/soon&lt;span style="color:#66d9ef">)&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -i &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>youtube-dl -f 160p -g https://www.twitch.tv/angledroit &lt;span style="color:#66d9ef">)&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -i &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>youtube-dl -f 160p -g https://www.twitch.tv/etoiles&lt;span style="color:#66d9ef">)&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -filter_complex &lt;span style="color:#e6db74">&amp;#34;[0:v][1:v][2:v][3:v]xstack=inputs=4:layout=0_0|w0_0|0_h0|w0_h0[v]&amp;#34;&lt;/span> -map &lt;span style="color:#e6db74">&amp;#34;[v]&amp;#34;&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -map 0:a &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -y output.mp4
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Note : it’s better to stack video vertically. Horizontal stack does works but then some services (like twitter) won’t accept the video because the image ratio will be too extreme.&lt;/p>
&lt;p>The -map 0:a here is necessary to select which audio you want to have.&lt;/p>
&lt;p>The format mkv also allow to record multiple video stream within one file that you can selected after that :&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>ffmpeg -i &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>youtube-dl -g https://www.twitch.tv/alphacast&lt;span style="color:#66d9ef">)&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#ae81ff">\ &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> -i &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>youtube-dl -g https://www.twitch.tv/colas_bim&lt;span style="color:#66d9ef">)&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -i &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>youtube-dl -g https://www.twitch.tv/eventisfr&lt;span style="color:#66d9ef">)&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -i &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>youtube-dl -g https://www.twitch.tv/fusiow&lt;span style="color:#66d9ef">)&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -map 0:1 -map 1:1 -map 2:1 -map 3:1 -map 0:0 &lt;span style="color:#ae81ff">\ &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> -c copy &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> out.mkv
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></content></item></channel></rss>